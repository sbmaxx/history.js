(function(a,b,c){"use strict";var d=a.console||c,e=a.document,f=a.navigator,g=a.sessionStorage||!1,h=a.setTimeout,i=a.clearTimeout,j=a.setInterval,k=a.clearInterval,l={stringify:b.stringify,parse:b.parseJSON},m=a.alert,n=a.History=a.History||{},o=a.history,p="#!",q=/\#!/;if(typeof n.init!="undefined")throw new Error("History.js Core has already been loaded...");n.init=function(){return typeof n.Adapter=="undefined"?!1:(typeof n.initCore!="undefined"&&n.initCore(),typeof n.initHtml4!="undefined"&&n.initHtml4(),!0)},n.initCore=function(){if(typeof n.initCore.initialized!="undefined")return!1;n.initCore.initialized=!0,n.options=n.options||{},n.options.hashChangeInterval=n.options.hashChangeInterval||250,n.options.safariPollInterval=n.options.safariPollInterval||500,n.options.doubleCheckInterval=n.options.doubleCheckInterval||500,n.options.storeInterval=n.options.storeInterval||1e3,n.options.busyDelay=n.options.busyDelay||250,n.options.debug=!0,n.options.initialTitle=n.options.initialTitle||e.title,n.options.sessionStorage=n.options.sessionStorage||!1,n.options.saveInitialState=n.options.saveInitialState||!1,n.intervalList=[],n.clearAllIntervals=function(){var a,b=n.intervalList;if(typeof b!="undefined"&&b!==null){for(a=0;a<b.length;a++)k(b[a]);n.intervalList=null}},n.debug=function(){(n.options.debug||!1)&&n.log.apply(n,arguments)},n.log=function(){var a=typeof d!="undefined"&&typeof d.log!="undefined"&&typeof d.log.apply!="undefined",b=e.getElementById("log"),c,f,g,h,i;a?(h=Array.prototype.slice.call(arguments),c=h.shift(),typeof d.debug!="undefined"?d.debug.apply(d,[c,h]):d.log.apply(d,[c,h])):c="\n"+arguments[0]+"\n";for(f=1,g=arguments.length;f<g;++f){i=arguments[f];if(typeof i=="object"&&typeof l!="undefined")try{i=l.stringify(i)}catch(j){}c+="\n"+i+"\n"}return b?(b.value+=c+"\n-----\n",b.scrollTop=b.scrollHeight-b.clientHeight):a||m(c),!0},n.getInternetExplorerMajorVersion=function(){var a=n.getInternetExplorerMajorVersion.cached=typeof n.getInternetExplorerMajorVersion.cached!="undefined"?n.getInternetExplorerMajorVersion.cached:function(){var a=3,b=e.createElement("div"),c=b.getElementsByTagName("i");while((b.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->")&&c[0]);return a>4?a:!1}();return a},n.isInternetExplorer=function(){var a=n.isInternetExplorer.cached=typeof n.isInternetExplorer.cached!="undefined"?n.isInternetExplorer.cached:Boolean(n.getInternetExplorerMajorVersion());return a},n.emulated={pushState:!Boolean(a.history&&a.history.pushState&&a.history.replaceState&&!/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(f.userAgent)&&!/AppleWebKit\/5([0-2]|3[0-2])/i.test(f.userAgent)),hashChange:Boolean(!("onhashchange"in a||"onhashchange"in e)||n.isInternetExplorer()&&n.getInternetExplorerMajorVersion()<8)},n.enabled=!n.emulated.pushState,n.bugs={setHash:Boolean(!n.emulated.pushState&&f.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(f.userAgent)),safariPoll:Boolean(!n.emulated.pushState&&f.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(f.userAgent)),ieDoubleCheck:Boolean(n.isInternetExplorer()&&n.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(n.isInternetExplorer()&&n.getInternetExplorerMajorVersion()<7)},n.isEmptyObject=function(a){for(var b in a)return!1;return!0},n.cloneObject=function(a){return a?b.extend({},a):{}},n.getRootUrl=function(){var a=e.location.protocol+"//"+(e.location.hostname||e.location.host);if(e.location.port||!1)a+=":"+e.location.port;return a+="/",a},n.getBaseHref=function(){var a=e.getElementsByTagName("base"),b=null,c="";return a.length===1&&(b=a[0],c=b.href.replace(/[^\/]+$/,"")),c=c.replace(/\/+$/,""),c&&(c+="/"),c},n.getBaseUrl=function(){var a=n.getBaseHref()||n.getBasePageUrl()||n.getRootUrl();return a},n.getPageUrl=function(){var a=n.getState(!1,!1),b=(a||{}).url||e.location.href,c;return c=b.replace(/\/+$/,"").replace(/[^\/]+$/,function(a,b,c){return/\./.test(a)?a:a+"/"}),c},n.getBasePageUrl=function(){var a=e.location.href.replace(/[#\?].*/,"").replace(/[^\/]+$/,function(a,b,c){return/[^\/]$/.test(a)?"":a}).replace(/\/+$/,"")+"/";return a},n.getFullUrl=function(a,b){var c=a,d=a.substring(0,1);return b=typeof b=="undefined"?!0:b,/[a-z]+\:\/\//.test(a)||(d==="/"?c=n.getRootUrl()+a.replace(/^\/+/,""):d==="#"?c=n.getPageUrl().replace(/#.*/,"")+a:d==="?"?c=n.getPageUrl().replace(/[\?#].*/,"")+a:b?c=n.getBaseUrl()+a.replace(/^(\.\/)+/,""):c=n.getBasePageUrl()+a.replace(/^(\.\/)+/,"")),c.replace(/\#$/,"")},n.getShortUrl=function(a){var b=a,c=n.getBaseUrl(),d=n.getRootUrl();return n.emulated.pushState&&(b=b.replace(c,"/")),b=b.replace(d,"/"),n.isTraditionalAnchor(b)&&(b="/"+b),b=b.replace(/^(\.\/)+/g,"./").replace(/\#$/,"").replace(q,"").replace("//","/"),b},n.store={},n.idToState=n.idToState||{},n.stateToId=n.stateToId||{},n.urlToId=n.urlToId||{},n.storedStates=n.storedStates||[],n.savedStates=n.savedStates||[],n.normalizeStore=function(){n.store.idToState=n.store.idToState||{},n.store.urlToId=n.store.urlToId||{},n.store.stateToId=n.store.stateToId||{}},n.getState=function(a,b){typeof a=="undefined"&&(a=!0),typeof b=="undefined"&&(b=!0);var c=n.getLastSavedState();return!c&&b&&(c=n.createStateObject()),a&&(c=n.cloneObject(c),c.url=c.url),c},n.getIdByState=function(a){var b=n.extractId(a.url),c;if(!b){c=n.getStateString(a);if(typeof n.stateToId[c]!="undefined")b=n.stateToId[c];else if(typeof n.store.stateToId[c]!="undefined")b=n.store.stateToId[c];else{for(;;){b=(new Date).getTime()+String(Math.random()).replace(/\D/g,"");if(typeof n.idToState[b]=="undefined"&&typeof n.store.idToState[b]=="undefined")break}n.stateToId[c]=b,n.idToState[b]=a}}return b},n.normalizeState=function(a){var b,c;if(!a||typeof a!="object")a={};if(typeof a.normalized!="undefined")return a;if(!a.data||typeof a.data!="object")a.data={};return b={},b.normalized=!0,b.title=a.title||"",b.url=n.getFullUrl(n.unescapeString(a.url||e.location.href)),b.hash=n.getShortUrl(b.url),b.data=n.cloneObject(a.data),b.id=n.getIdByState(b),b.url=b.url.replace(/\??\&_suid.*/,""),b.hashedUrl=n.getFullUrl(n.getShortUrl(b.url)),(n.emulated.pushState||n.bugs.safariPoll)&&n.hasUrlDuplicate(b)&&(b.url=b.hashedUrl),b},n.createStateObject=function(a,b,c){var d={data:a,title:b,url:c};return d=n.normalizeState(d),d},n.getStateById=function(a){a=String(a);var b=n.idToState[a]||n.store.idToState[a]||c;return b},n.getStateString=function(a){var b,c,d;return b=n.normalizeState(a),c={data:b.data,title:a.title,url:a.url},d=l.stringify(c),d},n.getStateId=function(a){var b,c;return b=n.normalizeState(a),c=b.id,c},n.getHashByState=function(a){var b,c;return b=n.normalizeState(a),c=b.hash,c},n.extractId=function(a){var b,c,d;return c=/(.*)\&_suid=([0-9]+)$/.exec(a),d=c?c[1]||a:a,b=c?String(c[2]||""):"",b||!1},n.isTraditionalAnchor=function(a){var b=!/[\/\?\.]/.test(a);return b},n.extractState=function(a,b){var c=null,d,e;return b=b||!1,d=n.extractId(a),d&&(c=n.getStateById(d)),c||(e=n.getFullUrl(a),d=n.getIdByUrl(e)||!1,d&&(c=n.getStateById(d)),!c&&b&&!n.isTraditionalAnchor(a)&&(c=n.createStateObject(null,null,e))),c},n.getIdByUrl=function(a){var b=n.urlToId[a]||n.store.urlToId[a]||c;return b},n.getLastSavedState=function(){return n.savedStates[n.savedStates.length-1]||c},n.getLastStoredState=function(){return n.storedStates[n.storedStates.length-1]||c},n.hasUrlDuplicate=function(a){var b=!1,c;return c=n.extractState(a.url),b=c&&c.id!==a.id,b},n.storeState=function(a){return n.urlToId[a.url]=a.id,n.storedStates.push(n.cloneObject(a)),a},n.isLastSavedState=function(a){var b=!1,c,d,e;return n.savedStates.length&&(c=a.id,d=n.getLastSavedState(),e=d.id,b=c===e),b},n.saveState=function(a){return n.isLastSavedState(a)?!1:(n.savedStates.push(n.cloneObject(a)),!0)},n.getStateByIndex=function(a){var b=null;return typeof a=="undefined"?b=n.savedStates[n.savedStates.length-1]:a<0?b=n.savedStates[n.savedStates.length+a]:b=n.savedStates[a],b},n.getHash=function(){return n.unescapeHash(e.location.hash)},n.unescapeString=function(b){var c=b,d;for(;;){d=a.decodeURI(c);if(d===c)break;c=d}return c},n.unescapeHash=function(a){var b=n.normalizeHash(a);return b=n.unescapeString(b),b},n.normalizeHash=function(a){var b=a.replace(/[^#]*#!?/,"").replace(/#.*/,"");return b},n.setHash=function(a,b){var c,d,f;return b!==!1&&n.busy()?(n.pushQueue({scope:n,callback:n.setHash,args:arguments,queue:b}),!1):(c=n.escapeHash(a),n.busy(!0),d=n.extractState(a,!0),d&&!n.emulated.pushState?n.pushState(d.data,d.title,d.url,!1):e.location.hash!==c&&(n.bugs.setHash?(f=n.getPageUrl(),n.pushState(null,null,f+p+c,!1)):n.setDocumentHash(p+c)),n)},n.setDocumentHash=function(a){e.location.hash=a.replace(/#/,"")},n.escapeHash=function(b){var c=n.normalizeHash(b);return c=a.encodeURI(c),n.bugs.hashEscape||(c=c.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),c},n.getHashByUrl=function(a){var b=String(a||"").replace(/([^#]*)(#(!\/)?)?([^#]*)#?(.*)/,"$4");return b=n.unescapeHash(b),b},n.setTitle=function(a){var b=a.title,c;b||(c=n.getStateByIndex(0),c&&c.url===a.url&&(b=c.title||n.options.initialTitle));try{e.getElementsByTagName("title")[0].innerHTML=b}catch(d){}return e.title=b,n},n.queues=[],n.busy=function(a){typeof a!="undefined"?n.busy.flag=a:typeof n.busy.flag=="undefined"&&(n.busy.flag=!1);if(!n.busy.flag){i(n.busy.timeout);var b=function(){var a,c,d;if(n.busy.flag)return;for(a=n.queues.length-1;a>=0;--a){c=n.queues[a];if(c.length===0)continue;d=c.shift(),n.fireQueueItem(d),n.busy.timeout=h(b,n.options.busyDelay)}};n.busy.timeout=h(b,n.options.busyDelay)}return n.busy.flag},n.busy.flag=!1,n.fireQueueItem=function(a){return a.callback.apply(a.scope||n,a.args||[])},n.pushQueue=function(a){return n.queues[a.queue||0]=n.queues[a.queue||0]||[],n.queues[a.queue||0].push(a),n},n.queue=function(a,b){return typeof a=="function"&&(a={callback:a}),typeof b!="undefined"&&(a.queue=b),n.busy()?n.pushQueue(a):n.fireQueueItem(a),n},n.clearQueue=function(){return n.busy.flag=!1,n.queues=[],n},n.stateChanged=!1,n.doubleChecker=!1,n.doubleCheckComplete=function(){return n.stateChanged=!0,n.doubleCheckClear(),n},n.doubleCheckClear=function(){return n.doubleChecker&&(i(n.doubleChecker),n.doubleChecker=!1),n},n.doubleCheck=function(a){return n.stateChanged=!1,n.doubleCheckClear(),n.bugs.ieDoubleCheck&&(n.doubleChecker=h(function(){return n.doubleCheckClear(),n.stateChanged||a(),!0},n.options.doubleCheckInterval)),n},n.safariStatePoll=function(){var b=n.extractState(e.location.href),c;if(!n.isLastSavedState(b))c=b;else return;return c||(c=n.createStateObject()),n.Adapter.trigger(a,"popstate"),n},n.back=function(a){return a!==!1&&n.busy()?(n.pushQueue({scope:n,callback:n.back,args:arguments,queue:a}),!1):(n.busy(!0),n.doubleCheck(function(){n.back(!1)}),o.go(-1),!0)},n.forward=function(a){return a!==!1&&n.busy()?(n.pushQueue({scope:n,callback:n.forward,args:arguments,queue:a}),!1):(n.busy(!0),n.doubleCheck(function(){n.forward(!1)}),o.go(1),!0)},n.go=function(a,b){var c;if(a>0)for(c=1;c<=a;++c)n.forward(b);else{if(!(a<0))throw new Error("History.go: History.go requires a positive or negative integer passed.");for(c=-1;c>=a;--c)n.back(b)}return n};if(n.emulated.pushState){var r=function(){};n.pushState=n.pushState||r,n.replaceState=n.replaceState||r}else n.onPopState=function(b,c){var d=!1,f=!1,g,h;return n.doubleCheckComplete(),g=n.getHash(),g?(h=n.extractState(g||e.location.href,!0),h?n.replaceState(h.data,h.title,h.url,!1):(n.Adapter.trigger(a,"anchorchange"),n.busy(!1)),n.expectedStateId=!1,!1):(d=n.Adapter.extractEventData("state",b,c)||!1,d?f=n.getStateById(d):n.expectedStateId?f=n.getStateById(n.expectedStateId):f=n.extractState(e.location.href),f||(f=n.createStateObject(null,null,e.location.href)),n.expectedStateId=!1,n.isLastSavedState(f)?(n.busy(!1),!1):(n.storeState(f),n.saveState(f),n.Adapter.trigger(a,"statechange"),n.busy(!1),!0))},n.Adapter.bind(a,"popstate",n.onPopState),n.pushState=function(b,c,d,e){if(n.getHashByUrl(d)&&n.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(e!==!1&&n.busy())return n.pushQueue({scope:n,callback:n.pushState,args:arguments,queue:e}),!1;n.busy(!0);var f=n.createStateObject(b,c,d);return n.isLastSavedState(f)?n.busy(!1):(n.storeState(f),n.expectedStateId=f.id,o.pushState(f.id,f.title,f.url),n.Adapter.trigger(a,"popstate")),!0},n.replaceState=function(b,c,d,e){if(n.getHashByUrl(d)&&n.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(e!==!1&&n.busy())return n.pushQueue({scope:n,callback:n.replaceState,args:arguments,queue:e}),!1;n.busy(!0);var f=n.createStateObject(b,c,d);return n.isLastSavedState(f)?n.busy(!1):(n.storeState(f),n.expectedStateId=f.id,o.replaceState(f.id,f.title,f.url),n.Adapter.trigger(a,"popstate")),!0};if(g&&n.options.sessionStorage){try{n.store=l.parse(g.getItem("History.store"))||{}}catch(s){n.store={}}n.normalizeStore()}else n.store={},n.normalizeStore();n.Adapter.bind(a,"beforeunload",n.clearAllIntervals),n.Adapter.bind(a,"unload",n.clearAllIntervals),n.options.saveInitialState&&n.saveState(n.storeState(n.extractState(e.location.href,!0))),g&&n.options.sessionStorage&&(n.onUnload=function(){var a,b;try{a=l.parse(g.getItem("History.store"))||{}}catch(c){a={}}a.idToState=a.idToState||{},a.urlToId=a.urlToId||{},a.stateToId=a.stateToId||{};for(b in n.idToState){if(!n.idToState.hasOwnProperty(b))continue;a.idToState[b]=n.idToState[b]}for(b in n.urlToId){if(!n.urlToId.hasOwnProperty(b))continue;a.urlToId[b]=n.urlToId[b]}for(b in n.stateToId){if(!n.stateToId.hasOwnProperty(b))continue;a.stateToId[b]=n.stateToId[b]}n.store=a,n.normalizeStore(),g.setItem("History.store",l.stringify(a))},n.intervalList.push(j(n.onUnload,n.options.storeInterval)),n.Adapter.bind(a,"beforeunload",n.onUnload),n.Adapter.bind(a,"unload",n.onUnload));if(!n.emulated.pushState){n.bugs.safariPoll&&n.intervalList.push(j(n.safariStatePoll,n.options.safariPollInterval));if(f.vendor==="Apple Computer, Inc."||(f.appCodeName||"")==="Mozilla")n.Adapter.bind(a,"hashchange",function(){n.Adapter.trigger(a,"popstate")}),n.getHash()&&n.Adapter.onDomLoad(function(){n.Adapter.trigger(a,"hashchange")})}},n.init()})(window,jQuery)